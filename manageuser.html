<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Premium Plans</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --danger: #e63946;
            --warning: #fca311;
            --gray: #6c757d;
            --white: #ffffff;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--white);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 40px;
            margin-right: 10px;
        }
        
        .logo h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info span {
            margin-right: 10px;
            font-weight: 500;
        }
        
        .role-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .admin {
            background: var(--primary);
            color: var(--white);
        }
        
        .founder {
            background: var(--warning);
            color: var(--dark);
        }
        
        .nav-tabs {
            display: flex;
            background: var(--white);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab.active {
            background: var(--primary);
            color: var(--white);
        }
        
        .content {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: var(--secondary);
        }
        
        .btn-secondary {
            background: var(--gray);
            color: var(--white);
        }
        
        .game-mode-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
        }
        
        .game-mode-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .game-mode-tab.active {
            background: var(--primary);
            color: var(--white);
        }
        
        .premium-plans {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .plan-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            position: relative;
        }
        
        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .plan-title {
            font-weight: 600;
            font-size: 16px;
        }
        
        .plan-category {
            background: var(--primary);
            color: var(--white);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .plan-details {
            margin-bottom: 10px;
        }
        
        .plan-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .plan-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }
        
        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .loader {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 750px;
            }
            
            .premium-plans {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .user-info {
                margin-top: 10px;
            }
            
            .logo h1 {
                font-size: 18px;
            }
        }
    </style>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Firebase Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="https://i.imghippo.com/files/JaE9679Nc.png" alt="Company Logo">
                <h1>Admin Dashboard</h1>
            </div>
            <div class="user-info">
                <span id="adminUsername">Admin</span>
                <div class="role-badge admin" id="adminRole">Admin</div>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="premium">Premium Plans</div>
            <div class="nav-tab" data-tab="categories">Categories</div>
        </div>
        
        <div class="content">
            <!-- Premium Plans Section -->
            <div class="content-section active" id="premiumSection">
                <h2 class="section-title">Manage Premium Plans</h2>
                
                <div class="game-mode-tabs">
                    <div class="game-mode-tab active" data-mode="lw">Lone Wolf (LW)</div>
                    <div class="game-mode-tab" data-mode="cs">Clash Squad (CS)</div>
                    <div class="game-mode-tab" data-mode="br">Battle Royal (BR)</div>
                </div>
                
                <form id="premiumPlanForm">
                    <div class="form-group">
                        <label for="planTitle">Plan Title</label>
                        <input type="text" class="form-control" id="planTitle" placeholder="Enter plan title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="planCategory">Category</label>
                        <select class="form-control" id="planCategory" required>
                            <option value="">Select Category</option>
                            <!-- Categories will be loaded dynamically -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="planPrice">Price ($)</label>
                        <input type="number" class="form-control" id="planPrice" placeholder="Enter price" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="silverPrice">Silver Price</label>
                        <input type="number" class="form-control" id="silverPrice" placeholder="Enter silver price" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="validity">Validity (Days)</label>
                        <input type="number" class="form-control" id="validity" placeholder="Enter validity in days" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="totalMatches">Total Matches</label>
                        <input type="number" class="form-control" id="totalMatches" placeholder="Enter total matches" min="1" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <span>Create Plan</span>
                        <div class="loader" id="planLoader"></div>
                    </button>
                </form>
                
                <div class="alert alert-danger" id="planError"></div>
                <div class="alert alert-success" id="planSuccess"></div>
                
                <h3 class="section-title" style="margin-top: 30px;">Existing Plans</h3>
                <div class="premium-plans" id="plansContainer">
                    <!-- Plans will be loaded dynamically -->
                </div>
            </div>
            
            <!-- Categories Section -->
            <div class="content-section" id="categoriesSection">
                <h2 class="section-title">Manage Categories</h2>
                
                <form id="categoryForm">
                    <div class="form-group">
                        <label for="categoryName">Category Name</label>
                        <input type="text" class="form-control" id="categoryName" placeholder="Enter category name" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <span>Create Category</span>
                        <div class="loader" id="categoryLoader"></div>
                    </button>
                </form>
                
                <div class="alert alert-danger" id="categoryError"></div>
                <div class="alert alert-success" id="categorySuccess"></div>
                
                <h3 class="section-title" style="margin-top: 30px;">Existing Categories</h3>
                <div id="categoriesContainer">
                    <!-- Categories will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD7pAsdYqkJzDbSsi8xbLsy2X5s0bgP040",
            authDomain: "aura-battle-main.firebaseapp.com",
            databaseURL: "https://aura-battle-main-default-rtdb.firebaseio.com",
            projectId: "aura-battle-main",
            storageBucket: "aura-battle-main.firebasestorage.app",
            messagingSenderId: "763779990289",
            appId: "1:763779990289:web:5caa7bc861e80b6f0b02b0",
            measurementId: "G-ZZXZ00HK07"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // DOM Elements
        const adminUsername = document.getElementById('adminUsername');
        const adminRole = document.getElementById('adminRole');
        const logoutBtn = document.getElementById('logoutBtn');
        const navTabs = document.querySelectorAll('.nav-tab');
        const contentSections = document.querySelectorAll('.content-section');
        const gameModeTabs = document.querySelectorAll('.game-mode-tab');
        
        // Form elements
        const premiumPlanForm = document.getElementById('premiumPlanForm');
        const categoryForm = document.getElementById('categoryForm');
        const planCategory = document.getElementById('planCategory');
        
        // Alert elements
        const planError = document.getElementById('planError');
        const planSuccess = document.getElementById('planSuccess');
        const categoryError = document.getElementById('categoryError');
        const categorySuccess = document.getElementById('categorySuccess');
        
        // Containers
        const plansContainer = document.getElementById('plansContainer');
        const categoriesContainer = document.getElementById('categoriesContainer');
        
        // Current state
        let currentGameMode = 'lw';
        let categories = [];
        let plans = { lw: [], cs: [], br: [] };
        
        // Check authentication and load data
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            loadCategories();
            loadPlans();
            setupEventListeners();
        });
        
        function checkAuthentication() {
            const adminRoleValue = localStorage.getItem('adminRole');
            const adminUsernameValue = localStorage.getItem('adminUsername');
            const loginTime = localStorage.getItem('loginTime');
            const currentTime = new Date().getTime();
            
            if (!adminRoleValue || !adminUsernameValue || !loginTime || (currentTime - parseInt(loginTime)) > 600000) {
                // Not authenticated or session expired
                window.location.href = 'index.html';
                return;
            }
            
            // Show admin info
            adminUsername.textContent = adminUsernameValue;
            adminRole.textContent = adminRoleValue;
            adminRole.className = 'role-badge ' + (adminRoleValue.toLowerCase() === 'founder' ? 'founder' : 'admin');
            
            // Verify admin exists in database
            verifyAdminInDatabase(adminUsernameValue);
        }
        
        function verifyAdminInDatabase(username) {
            const adminsRef = database.ref('admins');
            
            adminsRef.once('value')
                .then(snapshot => {
                    let adminExists = false;
                    
                    snapshot.forEach(childSnapshot => {
                        const admin = childSnapshot.val();
                        if (admin.username === username) {
                            adminExists = true;
                            return true;
                        }
                    });
                    
                    if (!adminExists) {
                        // Admin not found in database
                        localStorage.clear();
                        window.location.href = 'index.html';
                    }
                })
                .catch(error => {
                    console.error('Error verifying admin:', error);
                    showError(planError, 'Error verifying admin privileges');
                });
        }
        
        function setupEventListeners() {
            // Navigation tabs
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding section
                    contentSections.forEach(section => section.classList.remove('active'));
                    document.getElementById(tabName + 'Section').classList.add('active');
                });
            });
            
            // Game mode tabs
            gameModeTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    
                    // Update active tab
                    gameModeTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update current game mode and refresh plans
                    currentGameMode = mode;
                    displayPlans();
                });
            });
            
            // Form submissions
            premiumPlanForm.addEventListener('submit', function(e) {
                e.preventDefault();
                createPremiumPlan();
            });
            
            categoryForm.addEventListener('submit', function(e) {
                e.preventDefault();
                createCategory();
            });
            
            // Logout button
            logoutBtn.addEventListener('click', function() {
                localStorage.clear();
                window.location.href = 'index.html';
            });
        }
        
        function loadCategories() {
            const categoriesRef = database.ref('categories');
            
            categoriesRef.on('value', function(snapshot) {
                categories = [];
                snapshot.forEach(childSnapshot => {
                    const category = childSnapshot.val();
                    category.id = childSnapshot.key;
                    categories.push(category);
                });
                
                displayCategories();
                populateCategoryDropdown();
            });
        }
        
        function loadPlans() {
            const plansRef = database.ref('premiumPlans');
            
            plansRef.on('value', function(snapshot) {
                plans = { lw: [], cs: [], br: [] };
                snapshot.forEach(childSnapshot => {
                    const plan = childSnapshot.val();
                    plan.id = childSnapshot.key;
                    
                    if (plans[plan.gameMode]) {
                        plans[plan.gameMode].push(plan);
                    }
                });
                
                displayPlans();
            });
        }
        
        function displayCategories() {
            categoriesContainer.innerHTML = '';
            
            if (categories.length === 0) {
                categoriesContainer.innerHTML = '<p>No categories found. Create your first category!</p>';
                return;
            }
            
            categories.forEach(category => {
                const categoryEl = document.createElement('div');
                categoryEl.className = 'plan-card';
                categoryEl.innerHTML = `
                    <div class="plan-header">
                        <div class="plan-title">${category.name}</div>
                    </div>
                    <div class="plan-actions">
                        <button class="btn btn-danger btn-sm" onclick="deleteCategory('${category.id}')">Delete</button>
                    </div>
                `;
                
                categoriesContainer.appendChild(categoryEl);
            });
        }
        
        function displayPlans() {
            plansContainer.innerHTML = '';
            
            const currentPlans = plans[currentGameMode] || [];
            
            if (currentPlans.length === 0) {
                plansContainer.innerHTML = '<p>No plans found for this game mode. Create your first plan!</p>';
                return;
            }
            
            currentPlans.forEach(plan => {
                const planEl = document.createElement('div');
                planEl.className = 'plan-card';
                planEl.innerHTML = `
                    <div class="plan-header">
                        <div class="plan-title">${plan.title}</div>
                        <div class="plan-category">${plan.category}</div>
                    </div>
                    <div class="plan-details">
                        <div class="plan-detail">
                            <span>Price:</span>
                            <span>$${plan.price} | ${plan.silverPrice} Silver</span>
                        </div>
                        <div class="plan-detail">
                            <span>Validity:</span>
                            <span>${plan.validity} days</span>
                        </div>
                        <div class="plan-detail">
                            <span>Matches:</span>
                            <span>${plan.totalMatches}</span>
                        </div>
                    </div>
                    <div class="plan-actions">
                        <button class="btn btn-danger btn-sm" onclick="deletePlan('${plan.id}', '${plan.gameMode}')">Delete</button>
                    </div>
                `;
                
                plansContainer.appendChild(planEl);
            });
        }
        
        function populateCategoryDropdown() {
            planCategory.innerHTML = '<option value="">Select Category</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                planCategory.appendChild(option);
            });
        }
        
        function createPremiumPlan() {
            const title = document.getElementById('planTitle').value.trim();
            const category = planCategory.value;
            const price = parseFloat(document.getElementById('planPrice').value);
            const silverPrice = parseInt(document.getElementById('silverPrice').value);
            const validity = parseInt(document.getElementById('validity').value);
            const totalMatches = parseInt(document.getElementById('totalMatches').value);
            
            if (!title || !category || isNaN(price) || isNaN(silverPrice) || isNaN(validity) || isNaN(totalMatches)) {
                showError(planError, 'Please fill all fields with valid values');
                return;
            }
            
            const planData = {
                title,
                category,
                price,
                silverPrice,
                validity,
                totalMatches,
                gameMode: currentGameMode,
                createdAt: new Date().toISOString()
            };
            
            const plansRef = database.ref('premiumPlans');
            const newPlanRef = plansRef.push();
            
            newPlanRef.set(planData)
                .then(() => {
                    showSuccess(planSuccess, 'Plan created successfully!');
                    premiumPlanForm.reset();
                })
                .catch(error => {
                    showError(planError, 'Error creating plan: ' + error.message);
                });
        }
        
        function createCategory() {
            const name = document.getElementById('categoryName').value.trim();
            
            if (!name) {
                showError(categoryError, 'Please enter a category name');
                return;
            }
            
            // Check if category already exists
            if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                showError(categoryError, 'Category already exists');
                return;
            }
            
            const categoryData = {
                name,
                createdAt: new Date().toISOString()
            };
            
            const categoriesRef = database.ref('categories');
            const newCategoryRef = categoriesRef.push();
            
            newCategoryRef.set(categoryData)
                .then(() => {
                    showSuccess(categorySuccess, 'Category created successfully!');
                    categoryForm.reset();
                })
                .catch(error => {
                    showError(categoryError, 'Error creating category: ' + error.message);
                });
        }
        
        function deletePlan(planId, gameMode) {
            if (!confirm('Are you sure you want to delete this plan?')) {
                return;
            }
            
            const planRef = database.ref('premiumPlans/' + planId);
            
            planRef.remove()
                .then(() => {
                    showSuccess(planSuccess, 'Plan deleted successfully!');
                })
                .catch(error => {
                    showError(planError, 'Error deleting plan: ' + error.message);
                });
        }
        
        function deleteCategory(categoryId) {
            if (!confirm('Are you sure you want to delete this category? This may affect existing plans.')) {
                return;
            }
            
            const categoryRef = database.ref('categories/' + categoryId);
            
            categoryRef.remove()
                .then(() => {
                    showSuccess(categorySuccess, 'Category deleted successfully!');
                })
                .catch(error => {
                    showError(categoryError, 'Error deleting category: ' + error.message);
                });
        }
        
        function showError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        function showSuccess(element, message) {
            element.textContent = message;
            element.style.display = 'block';
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }
        
        // Make functions available globally for onclick handlers
        window.deletePlan = deletePlan;
        window.deleteCategory = deleteCategory;
    </script>
</body>
</html>
